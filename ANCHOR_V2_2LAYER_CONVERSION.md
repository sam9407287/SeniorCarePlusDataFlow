# ğŸ”Œ Anchor v2 è½‰æ›ï¼ˆä¿ç•™ 2å±¤çµæ§‹ï¼‰

> æ–°çš„æ‰å¹³åŒ–é‚è¼¯ï¼šä¿ç•™ â‰¤2å±¤çµæ§‹ + æ·±å±¤å­—æ®µåŠ å‰ç¶´æå‡

## ğŸ¯ è½‰æ›é‚è¼¯

```
è½‰æ›åŸå‰‡ï¼š
1. åŸå§‹ â‰¤ 2å±¤çš„çµæ§‹ä¿ç•™ä¸å‹•
2. åŸå§‹ > 2å±¤çš„çµæ§‹æ‹†åˆ°æœ€å…§ 2å±¤ï¼ŒåŠ ä¸Šã€Œè·¯å¾‘å‰ç¶´ã€
3. æœ€çµ‚çµæ§‹æ˜¯ 2å±¤ï¼šç¬¬1å±¤æ ¹å­—æ®µ + ç¬¬2å±¤ cloud_data ç‰©ä»¶
```

---

## ğŸ“¥ è¼¸å…¥ JSONï¼ˆ5å±¤åµŒå¥—æ·±åº¦ï¼‰

```json
{
  "id": "anchor_1762876688408",                    â† ç¬¬1å±¤
  "gatewayId": "gw_1762873074837",                 â† ç¬¬1å±¤
  "name": "DW30C5",                                â† ç¬¬1å±¤
  "macAddress": "ANCHOR:12485",                    â† ç¬¬1å±¤
  "status": "active",                              â† ç¬¬1å±¤
  "position": {                                    â† ç¬¬1å±¤ï¼ˆç‰©ä»¶ï¼‰
    "x": 59.654770985027035,                       â† ç¬¬2å±¤
    "y": -69.24380402090017,                       â† ç¬¬2å±¤
    "z": 1                                         â† ç¬¬2å±¤
  },
  "lastSeen": "2025-11-11T15:58:05.295Z",          â† ç¬¬1å±¤
  "isBound": true,                                 â† ç¬¬1å±¤
  "cloudData": {                                   â† ç¬¬1å±¤ï¼ˆç‰©ä»¶ï¼‰
    "content": "config",                           â† ç¬¬2å±¤
    "gateway_id": 4192812156,                      â† ç¬¬2å±¤
    "node": "ANCHOR",                              â† ç¬¬2å±¤
    "name": "DW30C5",                              â† ç¬¬2å±¤
    "id": 12485,                                   â† ç¬¬2å±¤
    "fw_update": 0,                                â† ç¬¬2å±¤
    "led": 1,                                      â† ç¬¬2å±¤
    "ble": 1,                                      â† ç¬¬2å±¤
    "initiator": 1,                                â† ç¬¬2å±¤
    "position": {                                  â† ç¬¬2å±¤ï¼ˆç‰©ä»¶ï¼‰
      "x": -150.64,                                â† ç¬¬3å±¤
      "y": 1.33,                                   â† ç¬¬3å±¤
      "z": 1                                       â† ç¬¬3å±¤
    },
    "receivedAt": "2025-11-11T15:58:05.295Z",      â† ç¬¬2å±¤
    "pub": {                                       â† ç¬¬2å±¤ï¼ˆç‰©ä»¶ï¼‰
      "msg": {                                     â† ç¬¬3å±¤ï¼ˆç‰©ä»¶ï¼‰
        "data": {                                  â† ç¬¬4å±¤ï¼ˆç‰©ä»¶ï¼‰
          "battery_voltage": 3.2,                  â† ç¬¬5å±¤ â­â­â­ æœ€æ·±
          "rssi": -52,                             â† ç¬¬5å±¤ â­â­â­ æœ€æ·±
          "heart_rate": 72,                        â† ç¬¬5å±¤ â­â­â­ æœ€æ·±
          "temperature": 36.5                      â† ç¬¬5å±¤ â­â­â­ æœ€æ·±
        }
      }
    }
  }
}
```

**å±¤ç´šçµ±è¨ˆï¼š5å±¤åµŒå¥—æ·±åº¦**

---

## ğŸ“¤ è¼¸å‡º JSONï¼ˆ2å±¤çµæ§‹ï¼‰

```json
{
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ç¬¬1å±¤ï¼šæ ¹å±¤å­—æ®µï¼ˆä¿ç•™ä¸å‹•ï¼‰
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "anchor_id": "anchor_1762876688408",            âœ… å¾ id
  "gateway_id": "gw_1762873074837",              âœ… å¾ gatewayId
  "name": "DW30C5",                              âœ… ä¿ç•™
  "mac_address": "ANCHOR:12485",                 âœ… å¾ macAddress
  "status": "active",                            âœ… ä¿ç•™
  "last_seen": "2025-11-11T15:58:05.295Z",       âœ… å¾ lastSeen
  "is_bound": true,                              âœ… å¾ isBound
  
  # ä¸­ç¹¼å­—æ®µ
  "device_type": "anchor",                       âœ… æ–°å¢
  "device_id": "anchor_1762876688408",           âœ… æ–°å¢
  "device_name": "DW30C5",                       âœ… æ–°å¢
  "timestamp": "2025-11-11T15:58:05.295Z",       âœ… æ–°å¢
  "processing_timestamp": "2025-11-19T01:22:29.143204Z",  âœ… æ–°å¢
  
  # ç¬¬1å±¤ç‰©ä»¶ï¼špositionï¼ˆä¿ç•™ä¸å‹•ï¼‰
  "position": {                                   âœ… ä¿ç•™ç‰©ä»¶çµæ§‹
    "x": 59.654770985027035,                     âœ… ä¿ç•™æ•¸å€¼
    "y": -69.24380402090017,                     âœ… ä¿ç•™æ•¸å€¼
    "z": 1                                       âœ… ä¿ç•™æ•¸å€¼
  },
  
  
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ç¬¬2å±¤ï¼šcloud_data ç‰©ä»¶ï¼ˆä¿ç•™ + åŠ å‰ç¶´ï¼‰
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "cloud_data": {                                 âœ… ä¿ç•™ç‰©ä»¶å®¹å™¨
    
    # ç¬¬2å±¤ç›´æ¥å­—æ®µï¼ˆä¿ç•™ä¸å‹•ï¼‰
    "content": "config",                          âœ… ä¿ç•™
    "gateway_id": 4192812156,                     âœ… ä¿ç•™ï¼ˆå€åˆ†æ–¼æ ¹å±¤ï¼‰
    "node": "ANCHOR",                             âœ… ä¿ç•™
    "name": "DW30C5",                             âœ… ä¿ç•™ï¼ˆå€åˆ†æ–¼æ ¹å±¤ï¼‰
    "id": 12485,                                  âœ… ä¿ç•™
    "fw_update": 0,                               âœ… ä¿ç•™
    "led": 1,                                     âœ… ä¿ç•™
    "ble": 1,                                     âœ… ä¿ç•™
    "initiator": 1,                               âœ… ä¿ç•™
    "receivedAt": "2025-11-11T15:58:05.295Z",     âœ… ä¿ç•™
    
    # ç¬¬2å±¤ç‰©ä»¶ï¼špositionï¼ˆä¿ç•™ä¸å‹•ï¼Œå€åˆ†æ–¼æ ¹å±¤ï¼‰
    "position": {                                  âœ… ä¿ç•™ç‰©ä»¶çµæ§‹
      "x": -150.64,                               âœ… ä¿ç•™æ•¸å€¼
      "y": 1.33,                                  âœ… ä¿ç•™æ•¸å€¼
      "z": 1                                      âœ… ä¿ç•™æ•¸å€¼
    },
    
    # ç¬¬2å±¤ç‰©ä»¶ï¼špubï¼ˆä¿ç•™å®Œæ•´çµæ§‹ï¼‰
    "pub": {                                       âœ… ä¿ç•™ç‰©ä»¶çµæ§‹
      "msg": {
        "data": {
          "battery_voltage": 3.2,                 âœ… ä¿ç•™åŸå§‹åµŒå¥—
          "rssi": -52,                            âœ… ä¿ç•™åŸå§‹åµŒå¥—
          "heart_rate": 72,                       âœ… ä¿ç•™åŸå§‹åµŒå¥—
          "temperature": 36.5                     âœ… ä¿ç•™åŸå§‹åµŒå¥—
        }
      }
    },
    
    # æ·±å±¤å­—æ®µæå‡ï¼ˆåŠ ã€Œè·¯å¾‘å‰ç¶´ã€ï¼‰
    "pub.msg.data.battery_voltage": 3.2,          âœ…â­ å¾ç¬¬5å±¤æå‡ + åŠ å‰ç¶´
    "pub.msg.data.rssi": -52,                     âœ…â­ å¾ç¬¬5å±¤æå‡ + åŠ å‰ç¶´
    "pub.msg.data.heart_rate": 72,                âœ…â­ å¾ç¬¬5å±¤æå‡ + åŠ å‰ç¶´
    "pub.msg.data.temperature": 36.5              âœ…â­ å¾ç¬¬5å±¤æå‡ + åŠ å‰ç¶´
  }
}
```

**çµæ§‹ï¼š2å±¤ï¼ˆç¬¬1å±¤æ ¹å­—æ®µ + ç¬¬2å±¤ cloud_data ç‰©ä»¶ï¼‰**

---

## ğŸ”„ è½‰æ›å°æ‡‰è¡¨

### ç¬¬1å±¤æ ¹å­—æ®µè½‰æ›

| # | åŸå§‹å­—æ®µ | åŸå§‹å±¤ç´š | åŸå§‹å€¼ | è½‰æ›æ–¹å¼ | æ–°å­—æ®µå | æ–°å€¼ |
|----|---------|--------|-------|--------|---------|------|
| 1 | id | 1 | "anchor_1762876688408" | é‡å‘½å | anchor_id | "anchor_1762876688408" |
| 2 | gatewayId | 1 | "gw_1762873074837" | é‡å‘½å | gateway_id | "gw_1762873074837" |
| 3 | name | 1 | "DW30C5" | ç›´æ¥ | name | "DW30C5" |
| 4 | macAddress | 1 | "ANCHOR:12485" | é‡å‘½å | mac_address | "ANCHOR:12485" |
| 5 | status | 1 | "active" | ç›´æ¥ | status | "active" |
| 6 | lastSeen | 1 | "2025-11-11T15:58:05.295Z" | é‡å‘½å | last_seen | "2025-11-11T15:58:05.295Z" |
| 7 | isBound | 1 | true | é‡å‘½å | is_bound | true |
| 8 | position | 1 | {x, y, z} | ä¿ç•™ç‰©ä»¶ | position | {x, y, z} |

### ç¬¬2å±¤ cloud_data å­—æ®µè½‰æ›

| # | åŸå§‹å­—æ®µ | åŸå§‹å±¤ç´š | åŸå§‹å€¼ | è½‰æ›æ–¹å¼ | æ–°å­—æ®µå | æ–°å€¼ | èªªæ˜ |
|----|---------|--------|-------|--------|---------|------|------|
| 1 | cloud_data.content | 2 | "config" | ç›´æ¥ | cloud_data.content | "config" | âœ… ä¿ç•™åœ¨ cloud_data å…§ |
| 2 | cloud_data.gateway_id | 2 | 4192812156 | ç›´æ¥ | cloud_data.gateway_id | 4192812156 | âœ… å€åˆ†æ–¼æ ¹å±¤ gateway_id |
| 3 | cloud_data.node | 2 | "ANCHOR" | ç›´æ¥ | cloud_data.node | "ANCHOR" | âœ… ä¿ç•™åœ¨ cloud_data å…§ |
| 4 | cloud_data.name | 2 | "DW30C5" | ç›´æ¥ | cloud_data.name | "DW30C5" | âœ… å€åˆ†æ–¼æ ¹å±¤ name |
| 5 | cloud_data.id | 2 | 12485 | ç›´æ¥ | cloud_data.id | 12485 | âœ… ä¿ç•™åœ¨ cloud_data å…§ |
| 6 | cloud_data.fw_update | 2 | 0 | ç›´æ¥ | cloud_data.fw_update | 0 | âœ… ä¿ç•™åœ¨ cloud_data å…§ |
| 7 | cloud_data.led | 2 | 1 | ç›´æ¥ | cloud_data.led | 1 | âœ… ä¿ç•™åœ¨ cloud_data å…§ |
| 8 | cloud_data.ble | 2 | 1 | ç›´æ¥ | cloud_data.ble | 1 | âœ… ä¿ç•™åœ¨ cloud_data å…§ |
| 9 | cloud_data.initiator | 2 | 1 | ç›´æ¥ | cloud_data.initiator | 1 | âœ… ä¿ç•™åœ¨ cloud_data å…§ |
| 10 | cloud_data.receivedAt | 2 | "2025-11-11T15:58:05.295Z" | ç›´æ¥ | cloud_data.receivedAt | "2025-11-11T15:58:05.295Z" | âœ… ä¿ç•™åœ¨ cloud_data å…§ |
| 11 | cloud_data.position | 2 | {x, y, z} | ä¿ç•™ç‰©ä»¶ | cloud_data.position | {x, y, z} | âœ… ä¿ç•™ç‰©ä»¶çµæ§‹ |
| 12 | cloud_data.pub | 2 | {...} | ä¿ç•™ç‰©ä»¶ | cloud_data.pub | {...} | âœ… ä¿ç•™å®Œæ•´åµŒå¥— |
| 13 | cloud_data.pub.msg.data.battery_voltage | 5 | 3.2 | æå‡+åŠ å‰ç¶´ | cloud_data.pub.msg.data.battery_voltage | 3.2 | â­ å¾ç¬¬5å±¤æå‡åˆ°ç¬¬2å±¤ |
| 14 | cloud_data.pub.msg.data.rssi | 5 | -52 | æå‡+åŠ å‰ç¶´ | cloud_data.pub.msg.data.rssi | -52 | â­ å¾ç¬¬5å±¤æå‡åˆ°ç¬¬2å±¤ |
| 15 | cloud_data.pub.msg.data.heart_rate | 5 | 72 | æå‡+åŠ å‰ç¶´ | cloud_data.pub.msg.data.heart_rate | 72 | â­ å¾ç¬¬5å±¤æå‡åˆ°ç¬¬2å±¤ |
| 16 | cloud_data.pub.msg.data.temperature | 5 | 36.5 | æå‡+åŠ å‰ç¶´ | cloud_data.pub.msg.data.temperature | 36.5 | â­ å¾ç¬¬5å±¤æå‡åˆ°ç¬¬2å±¤ |

---

## ğŸ¯ é—œéµæ”¹é€²

### âœ… 1. ä¿ç•™ 2å±¤çµæ§‹

**v1ï¼ˆå…¨éƒ¨å±•é–‹åˆ°1å±¤ï¼‰ï¼š**
```json
{
  "position_x": 59.65,
  "position_y": -69.24,
  "position_z": 1,
  "cloud_data.position_x": -150.64,  â† è¡çªï¼éœ€è¦å‰ç¶´
  "cloud_data.position_y": 1.33,
  ...
}
```

**v2ï¼ˆä¿ç•™ 2å±¤çµæ§‹ï¼‰ï¼š** âœ…
```json
{
  "position": {x, y, z},             â† æ ¹å±¤ position ç‰©ä»¶
  "cloud_data": {
    "position": {x, y, z},           â† cloud_data çš„ position ç‰©ä»¶ï¼ˆå€åˆ†é–‹ï¼‰
    "pub.msg.data.battery_voltage": 3.2,  â† æ·±å±¤å­—æ®µåŠ å‰ç¶´
    ...
  }
}
```

### âœ… 2. è‡ªå‹•è¡çªè§£æ±º

ç„¡éœ€é‡å‘½åï¼Œé€éç‰©ä»¶åµŒå¥—è‡ªå‹•å€åˆ†ï¼š
- æ ¹å±¤ `position` ä¿ç•™
- cloud_data å…§çš„ `position` ä¹Ÿä¿ç•™
- æ ¹å±¤ `gateway_id` ä¿ç•™
- cloud_data å…§çš„ `gateway_id` ä¹Ÿä¿ç•™ï¼ˆå€¼ä¸åŒï¼‰

### âœ… 3. æ·±å±¤å­—æ®µåŠ å‰ç¶´

è¶…é 2å±¤çš„å­—æ®µåŠ ä¸Šã€Œè·¯å¾‘å‰ç¶´ã€ï¼Œæ¸…æ¥šæ¨™ç¤ºä¾†æºï¼š
- `pub.msg.data.battery_voltage` â†’ æ¸…æ¥šä¾†è‡ª pub â†’ msg â†’ data
- `pub.msg.data.rssi` â†’ æ¸…æ¥šä¾†è‡ª pub â†’ msg â†’ data

### âœ… 4. åŸå§‹çµæ§‹æœ€å¤§åŒ–ä¿ç•™

- â‰¤ 2å±¤çš„çµæ§‹å®Œå…¨ä¿ç•™ï¼ˆä¸æ‹†ï¼‰
- ç‰©ä»¶çµæ§‹ä¿ç•™ï¼ˆä¸è½‰æ›ç‚ºå–®å€¼ï¼‰
- æ˜“æ–¼å‰ç«¯æˆ–å¾Œç«¯å†æ¬¡è§£æ

---

## ğŸ“Š å°æ¯” v1 vs v2

| é …ç›® | v1ï¼ˆ1å±¤ï¼‰ | v2ï¼ˆ2å±¤ï¼‰ |
|------|----------|----------|
| **æœ€çµ‚å±¤ç´š** | 1 å±¤ï¼ˆå®Œå…¨å±•é–‹ï¼‰ | 2 å±¤ï¼ˆä¿ç•™ç‰©ä»¶ï¼‰ |
| **è¡çªè§£æ±º** | å¿…é ˆé‡å‘½åæˆ–åŠ å‰ç¶´ | é€éç‰©ä»¶åµŒå¥—è‡ªå‹•è§£æ±º |
| **æ·±å±¤å­—æ®µ** | å…¨éƒ¨æå‡åˆ°ç¬¬1å±¤ | æå‡åˆ° cloud_data å±¤ç´š + åŠ å‰ç¶´ |
| **ç‰©ä»¶ä¿ç•™** | position è¢«åˆ†è§£ç‚º x, y, z | position ç‰©ä»¶å®Œæ•´ä¿ç•™ |
| **å­—æ®µæ•¸** | 17 å€‹å¹³é¢å­—æ®µ | 14 å€‹ï¼ˆåŒ…å« 2 å€‹ç‰©ä»¶ï¼‰ |
| **æ˜“è®€æ€§** | å·®ï¼ˆå…¨éƒ¨å¹³é¢ï¼‰ | âœ… å¥½ï¼ˆä¿ç•™å±¤ç´šï¼‰ |
| **è§£æé›£åº¦** | ç°¡å–®ï¼ˆç„¡åµŒå¥—ï¼‰ | âœ… ç°¡å–®ï¼ˆåªæœ‰ 2å±¤ï¼‰ |

---

## ğŸ’¡ ä½¿ç”¨å»ºè­°

### ä½•æ™‚ç”¨ v1ï¼ˆ1å±¤ï¼‰ï¼Ÿ
- éœ€è¦å®Œå…¨å¹³é¢çµæ§‹
- è³‡æ–™åº«ä¸æ”¯æŒç‰©ä»¶é¡å‹
- å‰ç«¯éœ€è¦æœ€ç°¡å–®çš„æ ¼å¼

### ä½•æ™‚ç”¨ v2ï¼ˆ2å±¤ï¼‰ï¼Ÿ âœ… **æ¨è–¦**
- éœ€è¦ä¿ç•™åŸå§‹çµæ§‹è³‡è¨Š
- è³‡æ–™åº«æ”¯æŒ JSON ç‰©ä»¶ï¼ˆPostgreSQLã€MongoDBï¼‰
- å‰ç«¯æ¡†æ¶æ”¯æŒç‰©ä»¶æ“ä½œï¼ˆReactã€Vueï¼‰
- éœ€è¦è‡ªå‹•é¿å…å­—æ®µè¡çª
- æƒ³ä¿ç•™ positionã€pub ç­‰åŸå§‹ç‰©ä»¶

---

## ğŸ“ æ–‡ä»¶ä½ç½®

- **è¼¸å…¥æª”**ï¼š`test_data/anchor_real_input_full.json`ï¼ˆåŒ…å« pub.msg.dataï¼‰
- **è¼¸å‡ºæª” v2**ï¼š`test_data/anchor_real_output_v2_full.json`
- **è½‰æ›ä»£ç¢¼**ï¼š`src/models/anchor_data_v2.py`
- **å°ç…§æ–‡æª”**ï¼šæ­¤æª”æ¡ˆ

---

**æœ€å¾Œæ›´æ–°ï¼š** 2025-11-19  
**ç‰ˆæœ¬ï¼š** v2 - ä¿ç•™ 2å±¤çµæ§‹  
**ç‹€æ…‹ï¼š** âœ… å®Œæˆ


